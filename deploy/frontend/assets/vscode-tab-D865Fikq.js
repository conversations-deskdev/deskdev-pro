import{w as _,R as N,r as l,j as t}from"./chunk-NL6KNZEE-aMulfElY.js";import{u as R}from"./react-redux-BM5MuSXj.js";import{I as i}from"./declaration-DTN74MXe.js";import{R as h}from"./agent-state-u5yf9HVO.js";import{u as S}from"./useQuery-C6Oy5OYj.js";import{O as y}from"./open-hands-B3E073cv.js";import{u as w}from"./use-conversation-id-DSAGxhnW.js";import{t as O}from"./vscode-url-helper-5Tt6LlE2.js";import{u as T}from"./use-runtime-is-ready-DcR3CT1f.js";import{u}from"./useTranslation-bTmhRewG.js";import"./open-hands-axios-BZ-FJWYr.js";import"./use-active-conversation-BqsQjzrn.js";import"./i18nInstance-DBIXdvxg.js";const C=()=>{const{t:e}=u(),{conversationId:r}=w(),o=T();return S({queryKey:["vscode_url",r],queryFn:async()=>{if(!r)throw new Error("No conversation ID");const s=await y.getVSCodeUrl(r);return s.vscode_url?{url:O(s.vscode_url),error:null}:{url:null,error:e(i.VSCODE$URL_NOT_AVAILABLE)}},enabled:o&&!!r,refetchOnMount:!0,retry:3})};function g(e,r=!1){try{const o=localStorage.getItem(`FEATURE_${e}`)||r.toString();return!!JSON.parse(o)}catch{return r}}const v=()=>g("VSCODE_IN_NEW_TAB");function A(){const{t:e}=u(),{data:r,isLoading:o,error:s}=C(),{curAgentState:a}=R(n=>n.agent),f=h.includes(a),m=N.useRef(null),[x,E]=l.useState(!1),[c,I]=l.useState(null);l.useEffect(()=>{if(r!=null&&r.url)try{const n=new URL(r.url).protocol,p=window.location.protocol;E(v()||n!==p)}catch{I(e("VSCODE$URL_PARSE_ERROR"))}},[r==null?void 0:r.url]);const d=()=>{r!=null&&r.url&&window.open(r.url,"_blank","noopener,noreferrer")};return f?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:e("DIFF_VIEWER$WAITING_FOR_RUNTIME")}):o?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:e("DIFF_VIEWER$WAITING_FOR_RUNTIME")}):s||r&&r.error||!(r!=null&&r.url)||c?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:c||(r==null?void 0:r.error)||String(s)||e(i.VSCODE$URL_NOT_AVAILABLE)}):x?t.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[t.jsx("div",{className:"text-xl text-tertiary-light text-center max-w-md",children:e("VSCODE$CROSS_ORIGIN_WARNING")}),t.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 bg-primary text-white rounded-sm hover:bg-primary-dark transition-colors",children:e("VSCODE$OPEN_IN_NEW_TAB")})]}):t.jsx("div",{className:"h-full w-full",children:t.jsx("iframe",{ref:m,title:e(i.VSCODE$TITLE),src:r.url,className:"w-full h-full border-0",allow:"clipboard-read; clipboard-write"})})}const k=_(A);export{k as default};
