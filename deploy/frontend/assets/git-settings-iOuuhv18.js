import{j as t,w as et,R as u}from"./chunk-NL6KNZEE-aMulfElY.js";import{u as st}from"./use-config-DZtddvT8.js";import{u as nt}from"./use-settings-Bsb8Zd3z.js";import{B as m,u as ot}from"./brand-button-CyoWaFBZ.js";import{u as at}from"./use-logout-BmnwZkNB.js";import{I as n}from"./declaration-DTN74MXe.js";import{S as p}from"./settings-input-DywAD7rj.js";import{u as c}from"./useTranslation-bTmhRewG.js";import{T as f}from"./Trans-Cf8Jcpvd.js";import{K as d}from"./key-status-icon-UANgyaJ3.js";import{a as rt,d as it}from"./custom-toast-handlers-zsVC4dT7.js";import{r as lt}from"./retrieve-axios-error-message-CoJTAmT2.js";import{I as w}from"./input-skeleton-BW1CxBOk.js";import{S as A}from"./subtext-skeleton-BVYhEIAb.js";import{u as ct}from"./open-hands-axios-BZ-FJWYr.js";import{S as ut}from"./secrets-service-F4YcpXAQ.js";import{u as pt}from"./use-user-providers-DfScIb2r.js";import"./useQuery-C6Oy5OYj.js";import"./open-hands-B3E073cv.js";import"./module-BG7DSedf.js";import"./mutation-DaRitmBy.js";import"./utils-FAyyxFNV.js";import"./optional-tag-jSauglgi.js";import"./i18nInstance-DBIXdvxg.js";import"./index-nrxvMbfg.js";function dt(){const{t:e}=c();return t.jsx("p",{"data-testid":"github-token-help-anchor",className:"text-xs",children:t.jsx(f,{i18nKey:n.GITHUB$TOKEN_HELP_TEXT,components:[t.jsx("a",{"aria-label":e(n.GIT$GITHUB_TOKEN_HELP_LINK),href:"https://github.com/settings/tokens/new?description=openhands-app&scopes=repo,user,workflow",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"github-token-help-anchor-link"),t.jsx("a",{"aria-label":e(n.GIT$GITHUB_TOKEN_SEE_MORE_LINK),href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"github-token-help-anchor-link-2")]})})}function ht({onChange:e,onGitHubHostChange:i,isGitHubTokenSet:a,name:l,githubHostSet:s}){const{t:r}=c();return t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(p,{testId:l,name:l,onChange:e,label:r(n.GITHUB$TOKEN_LABEL),type:"password",className:"w-full max-w-[680px]",placeholder:a?"<hidden>":"",startContent:a&&t.jsx(d,{testId:"gh-set-token-indicator",isSet:a})}),t.jsx(p,{onChange:i||(()=>{}),name:"github-host-input",testId:"github-host-input",label:r(n.GITHUB$HOST_LABEL),type:"text",className:"w-full max-w-[680px]",placeholder:"github.com",defaultValue:s||void 0,startContent:s&&s.trim()!==""&&t.jsx(d,{testId:"gh-set-host-indicator",isSet:!0})}),t.jsx(dt,{})]})}function bt(){const{t:e}=c();return t.jsx("p",{"data-testid":"gitlab-token-help-anchor",className:"text-xs",children:t.jsx(f,{i18nKey:n.GITLAB$TOKEN_HELP_TEXT,components:[t.jsx("a",{"aria-label":e(n.GIT$GITLAB_TOKEN_HELP_LINK),href:"https://gitlab.com/-/user_settings/personal_access_tokens?name=openhands-app&scopes=api,read_user,read_repository,write_repository",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"gitlab-token-help-anchor-link"),t.jsx("a",{"aria-label":e(n.GIT$GITLAB_TOKEN_SEE_MORE_LINK),href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"gitlab-token-help-anchor-link-2")]})})}function mt({onChange:e,onGitLabHostChange:i,isGitLabTokenSet:a,name:l,gitlabHostSet:s}){const{t:r}=c();return t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(p,{testId:l,name:l,onChange:e,label:r(n.GITLAB$TOKEN_LABEL),type:"password",className:"w-full max-w-[680px]",placeholder:a?"<hidden>":"",startContent:a&&t.jsx(d,{testId:"gl-set-token-indicator",isSet:a})}),t.jsx(p,{onChange:i||(()=>{}),name:"gitlab-host-input",testId:"gitlab-host-input",label:r(n.GITLAB$HOST_LABEL),type:"text",className:"w-full max-w-[680px]",placeholder:"gitlab.com",defaultValue:s||void 0,startContent:s&&s.trim()!==""&&t.jsx(d,{testId:"gl-set-host-indicator",isSet:!0})}),t.jsx(bt,{})]})}function gt(){const{t:e}=c();return t.jsx("p",{"data-testid":"bitbucket-token-help-anchor",className:"text-xs",children:t.jsx(f,{i18nKey:n.BITBUCKET$TOKEN_HELP_TEXT,components:[t.jsx("a",{"aria-label":e(n.GIT$BITBUCKET_TOKEN_HELP_LINK),href:"https://bitbucket.org/account/settings/app-passwords/new?scopes=repository:write,pullrequest:write,issue:write",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"bitbucket-token-help-anchor-link"),t.jsx("a",{"aria-label":e(n.GIT$BITBUCKET_TOKEN_SEE_MORE_LINK),href:"https://support.atlassian.com/bitbucket-cloud/docs/app-passwords/",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"bitbucket-token-help-anchor-link-2")]})})}function xt({onChange:e,onBitbucketHostChange:i,isBitbucketTokenSet:a,name:l,bitbucketHostSet:s}){const{t:r}=c();return t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(p,{testId:l,name:l,onChange:e,label:r(n.BITBUCKET$TOKEN_LABEL),type:"password",className:"w-full max-w-[680px]",placeholder:a?"<hidden>":"username:app_password",startContent:a&&t.jsx(d,{testId:"bb-set-token-indicator",isSet:a})}),t.jsx(p,{onChange:i||(()=>{}),name:"bitbucket-host-input",testId:"bitbucket-host-input",label:r(n.BITBUCKET$HOST_LABEL),type:"text",className:"w-full max-w-[680px]",placeholder:"bitbucket.org",defaultValue:s||void 0,startContent:s&&s.trim()!==""&&t.jsx(d,{testId:"bb-set-host-indicator",isSet:!0})}),t.jsx(gt,{})]})}function ft({slug:e}){const{t:i}=c();return t.jsx("a",{"data-testid":"configure-github-repositories-button",href:`https://github.com/apps/${e}/installations/new`,target:"_blank",rel:"noreferrer noopener",className:"py-9",children:t.jsx(m,{type:"button",variant:"secondary",children:i(n.GITHUB$CONFIGURE_REPOS)})})}function kt(){const{t:e}=c();return t.jsx("a",{"data-testid":"install-slack-app-button",href:"https://slack.com/oauth/v2/authorize?client_id=7477886716822.8729519890534&scope=app_mentions:read,chat:write,users:read,channels:history,groups:history,mpim:history,im:history&user_scope=channels:history,groups:history,im:history,mpim:history",target:"_blank",rel:"noreferrer noopener",className:"py-9",children:t.jsx(m,{type:"button",variant:"secondary",children:e(n.SLACK$INSTALL_APP)})})}function Tt(){return t.jsxs("div",{className:"px-11 py-9 flex flex-col gap-12",children:[t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(w,{}),t.jsx(A,{})]}),t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(w,{}),t.jsx(A,{})]})]})}const It=()=>{const e=ct();return ot({mutationFn:({providers:i})=>ut.addGitProvider(i),onSuccess:async()=>{await e.invalidateQueries({queryKey:["settings"]})},meta:{disableToast:!0}})};function Et(){const{t:e}=c(),{mutate:i,isPending:a}=It(),{mutate:l}=at(),{data:s,isLoading:r}=nt(),{providers:g}=pt(),{data:h}=st(),[O,k]=u.useState(!1),[v,T]=u.useState(!1),[P,I]=u.useState(!1),[$,E]=u.useState(!1),[V,_]=u.useState(!1),[R,S]=u.useState(!1),U=s==null?void 0:s.PROVIDER_TOKENS_SET.github,M=s==null?void 0:s.PROVIDER_TOKENS_SET.gitlab,q=s==null?void 0:s.PROVIDER_TOKENS_SET.bitbucket,b=(h==null?void 0:h.APP_MODE)==="saas",N=g.includes("github"),j=g.includes("gitlab"),H=g.includes("bitbucket"),F=async o=>{var y,G,B,L,C,K;if(o.get("disconnect-tokens-button")!==null){l();return}const D=((y=o.get("github-token-input"))==null?void 0:y.toString())||"",Q=((G=o.get("gitlab-token-input"))==null?void 0:G.toString())||"",z=((B=o.get("bitbucket-token-input"))==null?void 0:B.toString())||"",J=((L=o.get("github-host-input"))==null?void 0:L.toString())||"",W=((C=o.get("gitlab-host-input"))==null?void 0:C.toString())||"",Y=((K=o.get("bitbucket-host-input"))==null?void 0:K.toString())||"";i({providers:{github:{token:D,host:J},gitlab:{token:Q,host:W},bitbucket:{token:z,host:Y}}},{onSuccess:()=>{it(e(n.SETTINGS$SAVED))},onError:Z=>{const tt=lt(Z);rt(tt||e(n.ERROR$GENERIC))},onSettled:()=>{k(!1),T(!1),I(!1),E(!1),_(!1),S(!1)}})},X=!O&&!v&&!P&&!$&&!V&&!R,x=b&&h.APP_SLUG;return t.jsxs("form",{"data-testid":"git-settings-screen",action:F,className:"flex flex-col h-full justify-between",children:[!r&&t.jsxs("div",{className:"p-9 flex flex-col gap-12",children:[x&&!r&&t.jsx(ft,{slug:h.APP_SLUG}),x&&!r&&t.jsx(kt,{}),!b&&t.jsx(ht,{name:"github-token-input",isGitHubTokenSet:N,onChange:o=>{k(!!o)},onGitHubHostChange:o=>{E(!!o)},githubHostSet:U}),!b&&t.jsx(mt,{name:"gitlab-token-input",isGitLabTokenSet:j,onChange:o=>{T(!!o)},onGitLabHostChange:o=>{_(!!o)},gitlabHostSet:M}),!b&&t.jsx(xt,{name:"bitbucket-token-input",isBitbucketTokenSet:H,onChange:o=>{I(!!o)},onBitbucketHostChange:o=>{S(!!o)},bitbucketHostSet:q})]}),r&&t.jsx(Tt,{}),t.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:!x&&t.jsxs(t.Fragment,{children:[t.jsx(m,{testId:"disconnect-tokens-button",name:"disconnect-tokens-button",type:"submit",variant:"secondary",isDisabled:!N&&!j&&!H,children:e(n.GIT$DISCONNECT_TOKENS)}),t.jsxs(m,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:a||X,children:[!a&&e("SETTINGS$SAVE_CHANGES"),a&&e("SETTINGS$SAVING")]})]})})]})}const Jt=et(Et);export{Jt as default};
