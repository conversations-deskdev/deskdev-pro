import{j as s,r as x,w as _}from"./chunk-NL6KNZEE-aMulfElY.js";import{d as T}from"./module-BG7DSedf.js";import{u}from"./use-settings-Bsb8Zd3z.js";import{u as p}from"./use-save-settings-Ept-aF2B.js";import{I as t}from"./declaration-DTN74MXe.js";import{u as N}from"./useTranslation-bTmhRewG.js";import{B as f}from"./brand-button-CyoWaFBZ.js";import{a as j,d as C}from"./custom-toast-handlers-zsVC4dT7.js";import{r as g}from"./retrieve-axios-error-message-CoJTAmT2.js";import"./useQuery-C6Oy5OYj.js";import"./open-hands-axios-BZ-FJWYr.js";import"./open-hands-B3E073cv.js";import"./use-config-DZtddvT8.js";import"./i18nInstance-DBIXdvxg.js";import"./mutation-DaRitmBy.js";import"./utils-FAyyxFNV.js";import"./index-nrxvMbfg.js";function I({servers:n}){const{t:r}=N();return s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium mb-2",children:[r(t.SETTINGS$MCP_SSE_SERVERS)," ",s.jsxs("span",{className:"text-gray-500",children:["(",n.length,")"]})]}),n.map((e,o)=>s.jsxs("div",{className:"mb-2 p-2 bg-base-tertiary rounded-md",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_URL),":"]})," ",typeof e=="string"?e:e.url]}),typeof e!="string"&&e.api_key&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_API_KEY),":"]})," ",e.api_key?"Configured":r(t.SETTINGS$MCP_API_KEY_NOT_SET)]})]},`sse-${o}`))]})}function v({servers:n}){const{t:r}=N();return s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium mb-2",children:[r(t.SETTINGS$MCP_STDIO_SERVERS)," ",s.jsxs("span",{className:"text-gray-500",children:["(",n.length,")"]})]}),n.map((e,o)=>s.jsxs("div",{className:"mb-2 p-2 bg-base-tertiary rounded-md",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_NAME),":"]})," ",e.name]}),s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_COMMAND),":"]})," ",s.jsx("code",{className:"font-mono",children:e.command})]}),e.args&&e.args.length>0&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_ARGS),":"]})," ",s.jsx("code",{className:"font-mono",children:e.args.join(" ")})]}),e.env&&Object.keys(e.env).length>0&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(t.SETTINGS$MCP_ENV),":"]})," ",s.jsx("code",{className:"font-mono",children:Object.entries(e.env).map(([d,a])=>`${d}=${a}`).join(", ")})]})]},`stdio-${o}`))]})}function P({mcpConfig:n,onChange:r}){const{t:e}=N(),[o,d]=x.useState(()=>n?JSON.stringify(n,null,2):e(t.SETTINGS$MCP_DEFAULT_CONFIG)),[a,l]=x.useState(null),m=i=>{d(i.target.value)},h=()=>{try{const i=JSON.parse(o);if(!i.sse_servers||!Array.isArray(i.sse_servers))throw new Error(e(t.SETTINGS$MCP_ERROR_SSE_ARRAY));if(!i.stdio_servers||!Array.isArray(i.stdio_servers))throw new Error(e(t.SETTINGS$MCP_ERROR_STDIO_ARRAY));for(const c of i.sse_servers)if(typeof c!="string"&&(!c.url||typeof c.url!="string"))throw new Error(e(t.SETTINGS$MCP_ERROR_SSE_URL));for(const c of i.stdio_servers)if(!c.name||!c.command)throw new Error(e(t.SETTINGS$MCP_ERROR_STDIO_PROPS));r(i),l(null)}catch(i){l(i instanceof Error?i.message:e(t.SETTINGS$MCP_ERROR_INVALID_JSON))}};return s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-sm text-gray-400",children:e(t.SETTINGS$MCP_CONFIG_DESCRIPTION)}),s.jsx("textarea",{className:"w-full h-64 p-2 text-sm font-mono bg-base-tertiary rounded-md focus:border-blue-500 focus:outline-hidden",value:o,onChange:m,spellCheck:"false"}),a&&s.jsxs("div",{className:"mt-2 p-2 bg-red-100 border border-red-300 rounded-md text-sm text-red-700",children:[s.jsx("strong",{children:e(t.SETTINGS$MCP_CONFIG_ERROR)})," ",a]}),s.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:[s.jsx("strong",{children:e(t.SETTINGS$MCP_CONFIG_EXAMPLE)})," ",s.jsx("code",{children:'{ "sse_servers": ["https://example-mcp-server.com/sse"], "stdio_servers": [{ "name": "fetch", "command": "uvx", "args": ["mcp-server-fetch"] }] }'})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(f,{type:"button",variant:"primary",onClick:h,children:e(t.SETTINGS$MCP_APPLY_CHANGES)})})]})}function R({mcpConfig:n,onChange:r}){const{t:e}=N(),[o,d]=x.useState(!1),a=m=>{r(m),d(!1)},l=n||{sse_servers:[],stdio_servers:[]};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[s.jsx("div",{className:"text-sm font-medium",children:e(t.SETTINGS$MCP_TITLE)}),s.jsx("p",{className:"text-xs text-[#A3A3A3]",children:e(t.SETTINGS$MCP_DESCRIPTION)})]}),s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("a",{href:"https://deskdev.ai/usage/mcp",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:underline mr-3",onClick:m=>m.stopPropagation(),children:"Documentation"}),s.jsx(f,{type:"button",variant:"primary",onClick:()=>d(!o),children:e(o?t.SETTINGS$MCP_CANCEL:t.SETTINGS$MCP_EDIT_CONFIGURATION)})]})}),s.jsx("div",{children:o?s.jsx(P,{mcpConfig:n,onChange:a}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsx("div",{children:s.jsx(I,{servers:l.sse_servers})}),s.jsx("div",{children:s.jsx(v,{servers:l.stdio_servers})})]}),l.sse_servers.length===0&&l.stdio_servers.length===0&&s.jsx("div",{className:"mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-700",children:e(t.SETTINGS$MCP_NO_SERVERS_CONFIGURED)})]})})]})}function y(){const{t:n}=N(),{data:r,isLoading:e}=u(),{mutate:o,isPending:d}=p(),[a,l]=x.useState(r==null?void 0:r.MCP_CONFIG),[m,h]=x.useState(!1),i=S=>{l(S),h(!0)},c=()=>{r&&o({MCP_CONFIG:a},{onSuccess:()=>{var S,E;C(n(t.SETTINGS$SAVED)),T.capture("settings_saved",{HAS_MCP_CONFIG:a?"YES":"NO",MCP_SSE_SERVERS_COUNT:((S=a==null?void 0:a.sse_servers)==null?void 0:S.length)||0,MCP_STDIO_SERVERS_COUNT:((E=a==null?void 0:a.stdio_servers)==null?void 0:E.length)||0}),h(!1)},onError:S=>{const E=g(S);j(E||n(t.ERROR$GENERIC))}})};return e?s.jsx("div",{className:"p-9",children:n(t.HOME$LOADING)}):s.jsxs("form",{"data-testid":"mcp-settings-screen",action:c,className:"flex flex-col h-full justify-between",children:[s.jsx("div",{className:"p-9 flex flex-col gap-12",children:s.jsx(R,{mcpConfig:a,onChange:i})}),s.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:s.jsxs(f,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:!m||d,children:[!d&&n(t.SETTINGS$SAVE_CHANGES),d&&n(t.SETTINGS$SAVING)]})})]})}const K=_(y);export{K as default};
