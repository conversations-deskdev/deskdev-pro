import{R as m,r as d,j as e,N as U,a as w,h as ue,b as me,u as y,C as he,w as fe,O as pe,D as xe,E as Ee}from"./chunk-NL6KNZEE-aMulfElY.js";import{I as r}from"./declaration-DTN74MXe.js";import"./index-BKqui9cp.js";import{D as Ce,a as R,u as k}from"./use-settings-Bsb8Zd3z.js";import{u as M,a as Ne}from"./use-config-DZtddvT8.js";import{u as te}from"./useQuery-C6Oy5OYj.js";import{d as se}from"./module-BG7DSedf.js";import{O as P}from"./open-hands-B3E073cv.js";import{u as ge}from"./use-user-providers-DfScIb2r.js";import{L as $}from"./loading-spinner-2Uhf_oqB.js";import{c as v}from"./utils-FAyyxFNV.js";import{u as p}from"./useTranslation-bTmhRewG.js";import{t as Se,u as ae,C as Ie,a as Ae,B as _e,M as j,b as G,c as ne,d as q,e as ve}from"./conversation-card-BDeE3ZBQ.js";import{D as Te}from"./deskdev-logo-C7Hrd52l.js";import{S as je}from"./settings-DXOwWjXZ.js";import{F as Oe}from"./index-511DvycY.js";import{M as Le,o as we,H as Me,u as be}from"./help-link-XyzY7dBe.js";import{M as A}from"./modal-backdrop-BwRLozSC.js";import{e as ye}from"./settings-utils-DdNkVAkN.js";import{B as I,u as oe}from"./brand-button-CyoWaFBZ.js";import{K as Re}from"./key-status-icon-UANgyaJ3.js";import{S as Pe}from"./settings-input-DywAD7rj.js";import{u as B}from"./use-save-settings-Ept-aF2B.js";import{u as De}from"./open-hands-axios-BZ-FJWYr.js";import{R as Ue}from"./index-BkEG4wUf.js";import{u as ke,g as $e,L as b,s as Ge,a as ee}from"./use-logout-BmnwZkNB.js";import{a as re,d as Be}from"./custom-toast-handlers-zsVC4dT7.js";import{S as F}from"./all-hands-logo-BwXLYsLW.js";import{h as le}from"./handle-capture-consent-T7BcghmU.js";import{u as Fe}from"./use-balance-BkGHR0VC.js";import{T as He}from"./Trans-Cf8Jcpvd.js";import{i as Ve}from"./i18next-Bhc83OLH.js";import"./preload-helper-ckwbz45p.js";import"./i18nInstance-DBIXdvxg.js";import"./chunk-OBFX2YGI-PKFa5-VF.js";import"./react-redux-BM5MuSXj.js";import"./vscode-url-helper-5Tt6LlE2.js";import"./ws-client-provider-Dt-f4vrq.js";import"./query-client-config-CrBk_ULf.js";import"./redux-toolkit.modern-C17kwIqd.js";import"./agent-state-u5yf9HVO.js";import"./browser-slice-DCstnZW4.js";import"./initial-query-slice-kALvhVye.js";import"./retrieve-axios-error-message-CoJTAmT2.js";import"./mutation-DaRitmBy.js";import"./use-active-conversation-BqsQjzrn.js";import"./use-conversation-id-DSAGxhnW.js";import"./use-optimistic-user-message-DEbUmRkr.js";import"./iconBase-DIdAY4IJ.js";import"./map-provider-D8d2rI4b.js";import"./chunk-EG3YEEN2-C8jgHZop.js";import"./optional-tag-jSauglgi.js";import"./index-nrxvMbfg.js";const Ke=(t,a)=>{const n=`${a.hostname==="localhost"?a.protocol:"https:"}//${a.host}/oauth/keycloak/callback`;let o=a.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev");o===a.hostname&&a.hostname!=="localhost"&&(o=`auth.${a.hostname}`);const l="openid email profile",c=a.search?"&":"?",i=`${a.href.replace(/\/$/,"")}${c}login_method=${t}`;return`https://${o}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${t}&response_type=code&redirect_uri=${encodeURIComponent(n)}&scope=${encodeURIComponent(l)}&state=${encodeURIComponent(i)}`},T=t=>t.appMode==="saas"?Ke(t.identityProvider,new URL(window.location.href)):null,We=t=>T({appMode:t.appMode,identityProvider:"github"}),Ye=()=>{const{providers:t}=ge(),{data:a}=M(),s=te({queryKey:["user"],queryFn:P.getGitUser,enabled:!!(a!=null&&a.APP_MODE)&&t.length>0,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return m.useEffect(()=>{s.data&&se.identify(s.data.login,{company:s.data.company,name:s.data.name,email:s.data.email,user:s.data.login,mode:(a==null?void 0:a.APP_MODE)||"oss"})},[s.data]),s},ze=t=>d.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("g",{clipPath:"url(#clip0_40000158_426)"},d.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M4.84641 20.22C4.84641 20.22 7.35344 17.019 13.5395 17.019C19.7255 17.019 22.2337 20.22 22.2337 20.22M13.5395 13.0824C14.4344 13.0824 15.2926 12.7269 15.9254 12.0941C16.5582 11.4613 16.9137 10.6031 16.9137 9.70819C16.9137 8.8133 16.5582 7.95505 15.9254 7.32227C15.2926 6.68948 14.4344 6.33398 13.5395 6.33398C12.6446 6.33398 11.7863 6.68948 11.1536 7.32227C10.5208 7.95505 10.1653 8.8133 10.1653 9.70819C10.1653 10.6031 10.5208 11.4613 11.1536 12.0941C11.7863 12.7269 12.6446 13.0824 13.5395 13.0824Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_40000158_426"},d.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function Qe({src:t}){const{t:a}=p();return e.jsx("img",{src:t,alt:a(r.AVATAR$ALT_TEXT),className:"w-full h-full rounded-full"})}function D({children:t,tooltip:a,onClick:s,href:n,navLinkTo:o,ariaLabel:l,testId:c,className:u,disabled:i=!1}){const f=E=>{s&&!i&&(s(),E.preventDefault())},N=e.jsx("button",{type:"button","aria-label":l,"data-testid":c,onClick:f,className:v("hover:opacity-80",i&&"opacity-50 cursor-not-allowed",u),disabled:i,children:t});let h;return o&&!i?h=e.jsx(U,{to:o,onClick:f,className:({isActive:E})=>v("hover:opacity-80",E?"text-white":"text-[#9099AC]",u),"aria-label":l,"data-testid":c,children:t}):o&&i?h=e.jsx("button",{type:"button","aria-label":l,"data-testid":c,className:v("text-[#9099AC]","opacity-50 cursor-not-allowed",u),disabled:!0,children:t}):n&&!i?h=e.jsx("a",{href:n,target:"_blank",rel:"noreferrer noopener",className:v("hover:opacity-80",u),"aria-label":l,"data-testid":c,children:t}):n&&i?h=e.jsx("button",{type:"button","aria-label":l,"data-testid":c,className:v("opacity-50 cursor-not-allowed",u),disabled:!0,children:t}):h=N,e.jsx(Se,{content:a,closeDelay:100,placement:"right",children:h})}function Ze({onClick:t,avatarUrl:a,isLoading:s}){const{t:n}=p();return e.jsxs(D,{testId:"user-avatar",tooltip:n(r.USER$ACCOUNT_SETTINGS),ariaLabel:n(r.USER$ACCOUNT_SETTINGS),onClick:t,className:v("w-8 h-8 rounded-full flex items-center justify-center",s&&"bg-transparent"),children:[!s&&a&&e.jsx(Qe,{src:a}),!s&&!a&&e.jsx(ze,{"aria-label":n(r.USER$AVATAR_PLACEHOLDER),width:28,height:28,className:"text-[#9099AC]"}),s&&e.jsx($,{size:"small"})]})}function Xe({onLogout:t,onClose:a}){const s=ae(a),{t:n}=p();return e.jsx(Ie,{testId:"account-settings-context-menu",ref:s,className:"absolute right-full md:left-full -top-1 z-10 w-fit",children:e.jsx(Ae,{onClick:t,children:n(r.ACCOUNT_SETTINGS$LOGOUT)})})}function Je({onLogout:t,user:a,isLoading:s}){const[n,o]=m.useState(!1),l=()=>{o(i=>!i)},c=()=>{o(!1)},u=()=>{t(),c()};return e.jsxs("div",{"data-testid":"user-actions",className:"w-8 h-8 relative",children:[e.jsx(Ze,{avatarUrl:a==null?void 0:a.avatar_url,onClick:l,isLoading:s}),n&&e.jsx(Xe,{onLogout:u,onClose:c})]})}const qe=t=>d.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("g",{clipPath:"url(#clip0_40000158_408)"},d.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M20.5007 12H14.5007V6C14.5007 5.73478 14.3953 5.48043 14.2078 5.29289C14.0203 5.10536 13.7659 5 13.5007 5C13.2355 5 12.9811 5.10536 12.7936 5.29289C12.6061 5.48043 12.5007 5.73478 12.5007 6V12H6.5007C6.23549 12 5.98113 12.1054 5.7936 12.2929C5.60606 12.4804 5.5007 12.7348 5.5007 13C5.5007 13.2652 5.60606 13.5196 5.7936 13.7071C5.98113 13.8946 6.23549 14 6.5007 14H12.5007V20C12.5007 20.2652 12.6061 20.5196 12.7936 20.7071C12.9811 20.8946 13.2355 21 13.5007 21C13.7659 21 14.0203 20.8946 14.2078 20.7071C14.3953 20.5196 14.5007 20.2652 14.5007 20V14H20.5007C20.7659 14 21.0203 13.8946 21.2078 13.7071C21.3953 13.5196 21.5007 13.2652 21.5007 13C21.5007 12.7348 21.3953 12.4804 21.2078 12.2929C21.0203 12.1054 20.7659 12 20.5007 12Z",fill:"currentColor"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_40000158_408"},d.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function et({disabled:t=!1}){const{t:a}=p(),s=a(r.CONVERSATION$START_NEW);return e.jsx(D,{tooltip:s,ariaLabel:s,navLinkTo:"/",testId:"new-project-button",disabled:t,children:e.jsx(qe,{width:28,height:28})})}function tt({onClick:t,disabled:a=!1}){const{t:s}=p();return e.jsx(D,{testId:"settings-button",tooltip:s(r.SETTINGS$TITLE),ariaLabel:s(r.SETTINGS$TITLE),onClick:t,navLinkTo:"/settings",disabled:a,children:e.jsx(je,{width:28,height:28})})}function st({isOpen:t,onClick:a,disabled:s=!1}){const{t:n}=p();return e.jsx(D,{testId:"toggle-conversation-panel",tooltip:n(r.SIDEBAR$CONVERSATIONS),ariaLabel:n(r.SIDEBAR$CONVERSATIONS),onClick:a,disabled:s,children:e.jsx(Oe,{size:22,className:v(t?"text-white":"text-[#9099AC]",s&&"opacity-50")})})}function at({testId:t,title:a,description:s,buttons:n}){return e.jsx(_e,{testId:t,title:a,description:s,buttons:[{text:n.danger.text,onClick:n.danger.onClick,className:"bg-danger"},{text:n.cancel.text,onClick:n.cancel.onClick,className:"bg-neutral-500"}]})}function nt({settings:t,models:a,onClose:s}){const{mutate:n}=B(),o=w(),{t:l}=p(),c=m.useRef(null),[u,i]=m.useState(!1),f=async C=>{const g=ye(C);await n(g,{onSuccess:()=>{s(),se.capture("settings_saved",{LLM_MODEL:g.LLM_MODEL,LLM_API_KEY_SET:g.LLM_API_KEY_SET?"SET":"UNSET",SEARCH_API_KEY_SET:g.SEARCH_API_KEY?"SET":"UNSET",REMOTE_RUNTIME_RESOURCE_FACTOR:g.REMOTE_RUNTIME_RESOURCE_FACTOR})}})},N=()=>{const C=new FormData(c.current??void 0);f(C)},h=C=>{C.preventDefault();const g=new FormData(C.currentTarget);o.pathname.startsWith("/conversations/")?i(!0):f(g)},E=t.LLM_API_KEY_SET;return e.jsxs("div",{children:[e.jsxs("form",{ref:c,"data-testid":"settings-form",className:"flex flex-col gap-6",onSubmit:h,children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Le,{models:we(a),currentModel:t.LLM_MODEL}),e.jsx(Pe,{testId:"llm-api-key-input",name:"llm-api-key-input",label:l(r.SETTINGS_FORM$API_KEY),type:"password",className:"w-full",placeholder:E?"<hidden>":"",startContent:E&&e.jsx(Re,{isSet:E})}),e.jsx(Me,{testId:"llm-api-key-help-anchor",text:l(r.SETTINGS$DONT_KNOW_API_KEY),linkText:l(r.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://deskdev.ai/usage/local-setup#getting-an-api-key"})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(I,{testId:"save-settings-button",type:"submit",variant:"primary",className:"w-full",children:l(r.BUTTON$SAVE)})})]}),u&&e.jsx(A,{children:e.jsx(at,{title:l(r.MODAL$END_SESSION_TITLE),description:l(r.MODAL$END_SESSION_MESSAGE),buttons:{danger:{text:l(r.BUTTON$END_SESSION),onClick:N},cancel:{text:l(r.BUTTON$CANCEL),onClick:()=>i(!1)}}})})]})}function ot({onClose:t,settings:a}){var o;const s=be(),{t:n}=p();return e.jsx(A,{children:e.jsxs("div",{"data-testid":"ai-config-modal",className:"bg-base-secondary min-w-[384px] m-4 p-6 rounded-xl flex flex-col gap-2 border border-tertiary",children:[s.error&&e.jsx("p",{className:"text-danger text-xs",children:s.error.message}),e.jsx("span",{className:"text-xl leading-6 font-semibold -tracking-[0.01em]",children:n(r.AI_SETTINGS$TITLE)}),e.jsxs("p",{className:"text-xs text-[#A3A3A3]",children:[n(r.SETTINGS$DESCRIPTION)," ",n(r.SETTINGS$FOR_OTHER_OPTIONS),e.jsx(ue,{"data-testid":"advanced-settings-link",to:"/settings",className:"underline underline-offset-2 text-white",children:n(r.SETTINGS$SEE_ADVANCED_SETTINGS)})]}),s.isLoading&&e.jsx("div",{className:"flex justify-center",children:e.jsx($,{size:"small"})}),s.data&&e.jsx(nt,{settings:a||Ce,models:(o=s.data)==null?void 0:o.models,onClose:t})]})})}const rt=()=>{const{data:t}=R();return te({queryKey:["user","conversations"],queryFn:P.getUserConversations,enabled:!!t})},lt=()=>{const t=De();return oe({mutationFn:a=>P.deleteUserConversation(a.conversationId),onMutate:async a=>{await t.cancelQueries({queryKey:["user","conversations"]});const s=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],n=>n==null?void 0:n.filter(o=>o.conversation_id!==a.conversationId)),{previousConversations:s}},onError:(a,s,n)=>{n!=null&&n.previousConversations&&t.setQueryData(["user","conversations"],n.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})};function it({onConfirm:t,onCancel:a}){const{t:s}=p();return e.jsx(A,{children:e.jsxs(j,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(G,{title:s(r.CONVERSATION$CONFIRM_DELETE)}),e.jsx(ne,{description:s(r.CONVERSATION$DELETE_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:n=>n.stopPropagation(),children:[e.jsx(I,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:s(r.ACTION$CONFIRM)}),e.jsx(I,{type:"button",variant:"secondary",onClick:a,className:"w-full","data-testid":"cancel-button",children:s(r.BUTTON$CANCEL)})]})]})})}function ct({onConfirm:t,onClose:a}){const{t:s}=p();return e.jsx(A,{children:e.jsxs(j,{testID:"confirm-new-conversation-modal",children:[e.jsx(G,{title:s(r.CONVERSATION$EXIT_WARNING)}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(q,{text:s(r.ACTION$CONFIRM),onClick:t,className:"bg-[#C63143] flex-1"}),e.jsx(q,{text:s(r.BUTTON$CANCEL),onClick:a,className:"bg-tertiary flex-1"})]})]})})}function dt({onClose:t}){const{t:a}=p(),{conversationId:s}=me(),n=ae(t),o=y(),[l,c]=m.useState(!1),[u,i]=m.useState(!1),[f,N]=m.useState(null),{data:h,isFetching:E,error:C}=rt(),{mutate:g}=lt(),O=x=>{c(!0),N(x)},S=()=>{f&&g({conversationId:f},{onSuccess:()=>{f===s&&o("/")}})};return e.jsxs("div",{ref:n,"data-testid":"conversation-panel",className:"w-[350px] h-full border border-neutral-700 bg-base-secondary rounded-xl overflow-y-auto absolute",children:[E&&e.jsx("div",{className:"w-full h-full absolute flex justify-center items-center",children:e.jsx($,{size:"small"})}),C&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-danger",children:C.message})}),(h==null?void 0:h.length)===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-400",children:a(r.CONVERSATION$NO_CONVERSATIONS)})}),h==null?void 0:h.map(x=>e.jsx(U,{to:`/conversations/${x.conversation_id}`,onClick:t,children:({isActive:L})=>e.jsx(ve,{isActive:L,onDelete:()=>O(x.conversation_id),title:x.title,selectedRepository:x.selected_repository,lastUpdatedAt:x.last_updated_at,createdAt:x.created_at,conversationStatus:x.status,conversationId:x.conversation_id})},x.conversation_id)),l&&e.jsx(it,{onConfirm:()=>{S(),c(!1)},onCancel:()=>c(!1)}),u&&e.jsx(ct,{onConfirm:()=>{t()},onClose:()=>i(!1)})]})}function ut({isOpen:t,children:a}){if(!t)return null;const s=document.getElementById("root-outlet");return s?Ue.createPortal(e.jsx("div",{className:"absolute h-full w-full left-0 top-0 z-20 bg-black/80 rounded-xl",children:a}),s):null}function mt(){const t=w(),a=Ye(),{data:s}=M(),{data:n,error:o,isError:l,isFetching:c}=k(),{mutate:u}=ke(),[i,f]=m.useState(!1),[N,h]=m.useState(!1),E=(s==null?void 0:s.FEATURE_FLAGS.HIDE_LLM_SETTINGS)&&(s==null?void 0:s.APP_MODE)==="saas";return m.useEffect(()=>{E||(t.pathname==="/settings"?f(!1):!c&&l&&(o==null?void 0:o.status)!==404?re("Something went wrong while fetching settings. Please reload the page."):(s==null?void 0:s.APP_MODE)==="oss"&&(o==null?void 0:o.status)===404&&f(!0))},[o==null?void 0:o.status,o,c,t.pathname]),e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"h-[60px] w-full px-4 flex flex-row items-center justify-between bg-base-secondary rounded-xl mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{to:"/",className:"mr-6",children:e.jsx(Te,{})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(et,{disabled:(n==null?void 0:n.EMAIL_VERIFIED)===!1}),e.jsx(st,{isOpen:N,onClick:()=>(n==null?void 0:n.EMAIL_VERIFIED)===!1?null:h(C=>!C),disabled:(n==null?void 0:n.EMAIL_VERIFIED)===!1})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"mr-2",children:e.jsx(tt,{disabled:(n==null?void 0:n.EMAIL_VERIFIED)===!1})}),e.jsx(Je,{user:a.data?{avatar_url:a.data.avatar_url}:void 0,onLogout:u,isLoading:a.isFetching})]}),N&&e.jsx(ut,{isOpen:N,children:e.jsx(dt,{onClose:()=>h(!1)})})]}),i&&e.jsx(ot,{settings:n,onClose:()=>f(!1)})]})}const ht=t=>d.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),ft=t=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...t},d.createElement("defs",null,d.createElement("style",null,".cls-1{fill:currentColor;}")),d.createElement("g",{id:"LOGO"},d.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"}))),pt=t=>d.createElement("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("title",null,"Bitbucket"),d.createElement("path",{d:"M.778 1.213a.768.768 0 00-.768.892l3.263 19.81c.084.5.515.868 1.022.873H19.95a.772.772 0 00.77-.646l3.27-20.03a.768.768 0 00-.768-.891zM14.52 15.53H9.522L8.17 8.466h7.561z"}));function xt({githubAuthUrl:t,appMode:a}){const{t:s}=p(),n=T({appMode:a||null,identityProvider:"gitlab"}),o=T({appMode:a||null,identityProvider:"bitbucket"}),l=()=>{t&&(window.location.href=t)},c=()=>{n&&(window.location.href=n)},u=()=>{o&&(window.location.href=o)};return e.jsx(A,{children:e.jsxs(j,{className:"border border-tertiary",children:[e.jsx(F,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:s(r.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(I,{type:"button",variant:"primary",onClick:l,className:"w-full",startContent:e.jsx(ht,{width:20,height:20}),children:s(r.GITHUB$CONNECT_TO_GITHUB)}),e.jsx(I,{type:"button",variant:"primary",onClick:c,className:"w-full",startContent:e.jsx(ft,{width:20,height:20}),children:s(r.GITLAB$CONNECT_TO_GITLAB)}),e.jsx(I,{type:"button",variant:"primary",onClick:u,className:"w-full",startContent:e.jsx(pt,{width:20,height:20}),children:s(r.BITBUCKET$CONNECT_TO_BITBUCKET)})]})]})})}function Et(){const{t}=p();return e.jsx(A,{children:e.jsxs(j,{className:"border border-tertiary",children:[e.jsx(F,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:t(r.AUTH$LOGGING_BACK_IN)})})]})})}function Ct({onClose:t}){const{t:a}=p(),{mutate:s}=B(),n=async o=>{o.preventDefault();const c=new FormData(o.currentTarget).get("analytics")==="on";s({user_consents_to_analytics:c},{onSuccess:()=>{le(c),t()}})};return e.jsx(A,{children:e.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:n,className:"flex flex-col gap-2",children:e.jsxs(j,{className:"border border-tertiary",children:[e.jsx(G,{title:a(r.ANALYTICS$TITLE)}),e.jsx(ne,{children:a(r.ANALYTICS$DESCRIPTION)}),e.jsxs("label",{className:"flex gap-2 items-center self-start",children:[e.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),a(r.ANALYTICS$SEND_ANONYMOUS_DATA)]}),e.jsx(I,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:a(r.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const Nt=()=>{const{mutate:t}=B();return{migrateUserConsent:m.useCallback(async s=>{const n=localStorage.getItem("analytics-consent");n&&(s==null||s.handleAnalyticsWasPresentInLocalStorage(),await t({user_consents_to_analytics:n==="true"},{onSuccess:()=>{le(n==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function gt(){const{t}=p(),{mutate:a,isPending:s}=oe({mutationFn:P.createBillingSessionResponse,onSuccess:n=>{window.location.href=n},onError:()=>{re(t(r.BILLING$ERROR_WHILE_CREATING_SESSION))}});return e.jsx(A,{children:e.jsxs(j,{className:"border border-tertiary",children:[e.jsx(F,{width:68,height:46}),e.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t(r.BILLING$YOUVE_GOT_50)}),e.jsx("p",{children:e.jsx(He,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:e.jsx("strong",{})}})})]}),e.jsx(I,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:s,onClick:a,children:t(r.BILLING$PROCEED_TO_STRIPE)})]})})}const St=()=>{const{data:t,isLoading:a}=M(),{data:s,isLoading:n}=R(),o=$e(),l=T({appMode:(t==null?void 0:t.APP_MODE)||null,identityProvider:"github"}),c=T({appMode:(t==null?void 0:t.APP_MODE)||null,identityProvider:"gitlab"}),u=T({appMode:(t==null?void 0:t.APP_MODE)||null,identityProvider:"bitbucket"});d.useEffect(()=>{if((t==null?void 0:t.APP_MODE)!=="saas"||a||n||s||!o)return;let i=null;if(o===b.GITHUB?i=l:o===b.GITLAB?i=c:o===b.BITBUCKET&&(i=u),i){const f=new URL(i);f.searchParams.append("login_method",o),window.location.href=f.toString()}},[t==null?void 0:t.APP_MODE,s,a,n,o,l,c,u])},It=()=>{const t=w(),{data:a,isLoading:s}=R(),{data:n}=M(),o=y();d.useEffect(()=>{if((n==null?void 0:n.APP_MODE)!=="saas"||s||!a)return;const l=new URLSearchParams(t.search),c=l.get("login_method");if(Object.values(b).includes(c)){Ge(c),l.delete("login_method");const u=`${t.pathname}${l.toString()?`?${l.toString()}`:""}`;o(u,{replace:!0})}},[a,s,t.search,n==null?void 0:n.APP_MODE])};function At({children:t}){const{data:a,isLoading:s}=k(),n=y(),{pathname:o}=w();return m.useEffect(()=>{s||(a==null?void 0:a.EMAIL_VERIFIED)===!1&&o!=="/settings/user"&&n("/settings/user",{replace:!0})},[a==null?void 0:a.EMAIL_VERIFIED,o,n,s]),t}const As=he(function(){const a=xe(),{t:s}=p();return Ee(a)?e.jsxs("div",{children:[e.jsx("h1",{children:a.status}),e.jsx("p",{children:a.statusText}),e.jsx("pre",{children:a.data instanceof Object?JSON.stringify(a.data):a.data})]}):a instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:s(r.ERROR$GENERIC)}),e.jsx("pre",{children:a.message})]}):e.jsx("div",{children:e.jsx("h1",{children:s(r.ERROR$UNKNOWN)})})}),_s=fe(function(){var H,V,K,W,Y,z,Q,Z,X;const a=y(),{pathname:s}=w(),n=Ne(),{data:o}=k(),{error:l}=Fe(),{migrateUserConsent:c}=Nt(),{t:u}=p(),i=M(),{data:f,isFetching:N,isError:h}=R(),E=We({appMode:((H=i.data)==null?void 0:H.APP_MODE)||null,gitHubClientId:((V=i.data)==null?void 0:V.GITHUB_CLIENT_ID)||null}),C=n?null:E,[g,O]=m.useState(!1);St(),It(),m.useEffect(()=>{!n&&(o!=null&&o.LANGUAGE)&&Ve.changeLanguage(o.LANGUAGE)},[o==null?void 0:o.LANGUAGE,n]),m.useEffect(()=>{if(!n){const _=(o==null?void 0:o.USER_CONSENTS_TO_ANALYTICS)===null;O(_)}},[o,n]),m.useEffect(()=>{n||c({handleAnalyticsWasPresentInLocalStorage:()=>{O(!1)}})},[n]),m.useEffect(()=>{var _;o!=null&&o.IS_NEW_USER&&((_=i.data)==null?void 0:_.APP_MODE)==="saas"&&Be(u(r.BILLING$YOURE_IN))},[o==null?void 0:o.IS_NEW_USER,(K=i.data)==null?void 0:K.APP_MODE]),m.useEffect(()=>{!n&&(l==null?void 0:l.status)===402&&s!=="/"&&a("/")},[l==null?void 0:l.status,s,n]);const S=m.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(ee.LOGIN_METHOD)!==null:!1,[]),[x,L]=m.useState(S());m.useEffect(()=>{const _=de=>{de.key===ee.LOGIN_METHOD&&L(S())},J=()=>{L(S())};return window.addEventListener("storage",_),window.addEventListener("focus",J),()=>{window.removeEventListener("storage",_),window.removeEventListener("focus",J)}},[S]),m.useEffect(()=>{L(S())},[f,S]);const ie=!f&&!h&&!N&&!n&&((W=i.data)==null?void 0:W.APP_MODE)==="saas"&&!x,ce=!f&&!h&&!N&&!n&&((Y=i.data)==null?void 0:Y.APP_MODE)==="saas"&&x;return e.jsxs("div",{"data-testid":"root-layout",className:"bg-base p-3 h-screen md:min-w-[1024px] flex flex-col gap-0",children:[e.jsx(mt,{}),e.jsx("div",{id:"root-outlet",className:"h-[calc(100%-70px)] w-full relative overflow-auto",children:e.jsx(At,{children:e.jsx(pe,{})})}),ie&&e.jsx(xt,{githubAuthUrl:C,appMode:(z=i.data)==null?void 0:z.APP_MODE}),ce&&e.jsx(Et,{}),((Q=i.data)==null?void 0:Q.APP_MODE)==="oss"&&g&&e.jsx(Ct,{onClose:()=>{O(!1)}}),((Z=i.data)==null?void 0:Z.FEATURE_FLAGS.ENABLE_BILLING)&&((X=i.data)==null?void 0:X.APP_MODE)==="saas"&&(o==null?void 0:o.IS_NEW_USER)&&e.jsx(gt,{})]})});export{As as ErrorBoundary,_s as default};
