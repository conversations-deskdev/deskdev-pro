import{r as f,u as ae,B as ie,j as s,h as ce,R as g,w as le}from"./chunk-NL6KNZEE-aMulfElY.js";import{u as R,k as de,n as ue,o as me}from"./open-hands-axios-BZ-FJWYr.js";import{u as pe,B as I}from"./brand-button-CyoWaFBZ.js";import{d as xe}from"./module-BG7DSedf.js";import{a as he,u as fe}from"./react-redux-BM5MuSXj.js";import{O as j}from"./open-hands-B3E073cv.js";import{s as ge}from"./initial-query-slice-kALvhVye.js";import{D as Ee}from"./deskdev-logo-C7Hrd52l.js";import{u as d}from"./useTranslation-bTmhRewG.js";import{u as Se,a as Ne}from"./use-settings-Bsb8Zd3z.js";import{u as b}from"./useQuery-C6Oy5OYj.js";import{S as U}from"./settings-dropdown-input-CmgzkTwP.js";import{I as E}from"./declaration-DTN74MXe.js";import{s as k}from"./chunk-OBFX2YGI-PKFa5-VF.js";import{u as P}from"./use-config-DZtddvT8.js";import{u as B}from"./use-user-providers-DfScIb2r.js";import{c as M}from"./utils-FAyyxFNV.js";import{u as _e}from"./use-optimistic-user-message-DEbUmRkr.js";import"./mutation-DaRitmBy.js";import"./redux-toolkit.modern-C17kwIqd.js";import"./i18nInstance-DBIXdvxg.js";import"./optional-tag-jSauglgi.js";import"./chunk-EG3YEEN2-C8jgHZop.js";import"./preload-helper-ckwbz45p.js";import"./index-BkEG4wUf.js";function je(e,t){const n=R(t);return be({filters:{...e,status:"pending"}},n).length}function H(e,t){return e.findAll(t.filters).map(n=>t.select?t.select(n):n.state)}function be(e={},t){const n=R(t).getMutationCache(),o=f.useRef(e),r=f.useRef(null);return r.current||(r.current=H(n,e)),f.useEffect(()=>{o.current=e}),f.useSyncExternalStore(f.useCallback(i=>n.subscribe(()=>{const a=de(r.current,H(n,o.current));r.current!==a&&(r.current=a,ue.schedule(i))}),[n]),()=>r.current,()=>r.current)}const A=()=>{const e=ae(),t=he(),n=R(),{selectedRepository:o,files:r,replayJson:i}=fe(a=>a.initialQuery);return pe({mutationKey:["create-conversation"],mutationFn:async a=>(a.q&&t(ge(a.q)),j.createConversation(a.selectedRepository?a.selectedRepository.full_name:void 0,a.selectedRepository?a.selectedRepository.git_provider:void 0,a.q,r,i||void 0,a.suggested_task||void 0,a.selected_branch)),onSuccess:async({conversation_id:a},{q:p})=>{xe.capture("initial_query_submitted",{entry_point:"task_form",query_character_length:p==null?void 0:p.length,has_repository:!!o,has_files:r.length>0,has_replay_json:!!i}),await n.invalidateQueries({queryKey:["user","conversations"]}),e(`/conversations/${a}`)}})},D=()=>{const e=ie(),t=je({mutationKey:["create-conversation"]}),n=!!e.location;return t>0||n};function Oe(){const{mutate:e,isPending:t,isSuccess:n}=A(),o=D(),{t:r}=d(),i=t||n||o;return s.jsxs("header",{className:"flex flex-col gap-5",children:[s.jsx("div",{className:"flex justify-center items-center py-2",children:s.jsx(Ee,{width:200,height:50,className:"text-2xl"})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"heading",children:r("HOME$LETS_START_BUILDING")}),s.jsxs(I,{testId:"header-launch-button",variant:"primary",type:"button",onClick:()=>e({}),isDisabled:i,children:[!i&&r("HOME$LAUNCH_FROM_SCRATCH"),i&&r("HOME$LOADING")]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm max-w-[424px]",children:r("HOME$OPENHANDS_DESCRIPTION")}),s.jsx("p",{className:"text-sm",children:r("HOME$NOT_SURE_HOW_TO_START")})]})]})}function Ce(){const{isLoading:e}=Se(),{t}=d();return s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("p",{children:t("HOME$CONNECT_PROVIDER_MESSAGE")}),s.jsx(ce,{"data-testid":"navigate-to-settings-button",to:"/settings/integrations",children:s.jsxs(I,{type:"button",variant:"primary",isDisabled:e,children:[!e&&t("SETTINGS$TITLE"),e&&t("HOME$LOADING")]})})]})}const F=()=>b({queryKey:["repositories"],queryFn:j.retrieveUserGitRepositories,staleTime:1e3*60*5,gcTime:1e3*60*15}),Te=e=>b({queryKey:["repository",e,"branches"],queryFn:async()=>e?j.getRepositoryBranches(e):[],enabled:!!e,staleTime:1e3*60*5});function ye(e){return b({queryKey:["repositories",e],queryFn:()=>j.searchGitRepositories(e,3),enabled:!!e,staleTime:1e3*60*5,gcTime:1e3*60*15})}function Re(e,t){const[n,o]=f.useState(e);return f.useEffect(()=>{const r=setTimeout(()=>o(e),t);return()=>clearTimeout(r)},[e,t]),n}const T=e=>e.trim().replace(/https?:\/\//,"").replace(/github.com\//,"").replace(/\.git$/,"").toLowerCase();function Ie({items:e,onSelectionChange:t,onInputChange:n,defaultFilter:o}){const{t:r}=d();return s.jsx(U,{testId:"repo-dropdown",name:"repo-dropdown",placeholder:r(E.REPOSITORY$SELECT_REPO),items:e,wrapperClassName:"max-w-[500px]",onSelectionChange:t,onInputChange:n,defaultFilter:o})}function Me(){const{t:e}=d();return s.jsxs("div",{"data-testid":"repo-dropdown-loading",className:"flex items-center gap-2 max-w-[500px] h-10 px-3 bg-tertiary border border-[#717888] rounded-sm",children:[s.jsx(k,{size:"sm"}),s.jsx("span",{className:"text-sm",children:e("HOME$LOADING_REPOSITORIES")})]})}function Ae(){const{t:e}=d();return s.jsx("div",{"data-testid":"repo-dropdown-error",className:"flex items-center gap-2 max-w-[500px] h-10 px-3 bg-tertiary border border-[#717888] rounded-sm text-red-500",children:s.jsx("span",{className:"text-sm",children:e("HOME$FAILED_TO_LOAD_REPOSITORIES")})})}function $({items:e,onSelectionChange:t,onInputChange:n,isDisabled:o,selectedKey:r}){const{t:i}=d();return s.jsx(U,{testId:"branch-dropdown",name:"branch-dropdown",placeholder:i(E.REPOSITORY$SELECT_BRANCH),items:e,wrapperClassName:"max-w-[500px]",onSelectionChange:t,onInputChange:n,isDisabled:o,selectedKey:r})}function De(){const{t:e}=d();return s.jsxs("div",{"data-testid":"branch-dropdown-loading",className:"flex items-center gap-2 max-w-[500px] h-10 px-3 bg-tertiary border border-[#717888] rounded-sm",children:[s.jsx(k,{size:"sm"}),s.jsx("span",{className:"text-sm",children:e("HOME$LOADING_BRANCHES")})]})}function ve(){const{t:e}=d();return s.jsx("div",{"data-testid":"branch-dropdown-error",className:"flex items-center gap-2 max-w-[500px] h-10 px-3 bg-tertiary border border-[#717888] rounded-sm text-red-500",children:s.jsx("span",{className:"text-sm",children:e("HOME$FAILED_TO_LOAD_BRANCHES")})})}function He({onRepoSelection:e}){const[t,n]=g.useState(null),[o,r]=g.useState(null),i=g.useRef(!1),{data:a,isLoading:p,isError:S}=F(),{data:l,isLoading:u,isError:O}=Te((t==null?void 0:t.full_name)||null),{mutate:v,isPending:N,isSuccess:G}=A(),K=D(),{t:V}=d(),[q,Y]=g.useState(""),Q=Re(q,300),{data:W}=ye(Q);g.useEffect(()=>{if(l&&l.length>0&&!o&&!u&&!i.current){const c=l.find(h=>h.name==="main"),m=l.find(h=>h.name==="master");c?r(c):m&&r(m)}},[l,u,o]);const C=N||G||K,x=a==null?void 0:a.concat(W||[]),z=x==null?void 0:x.map(c=>({key:c.id,label:decodeURIComponent(c.full_name)})),J=l==null?void 0:l.map(c=>({key:c.name,label:c.name})),X=c=>{const m=x==null?void 0:x.find(h=>h.id===c);m&&e(m.full_name),n(m||null),r(null),i.current=!1},Z=c=>{const m=l==null?void 0:l.find(h=>h.name===c);r(m||null),i.current=!1},ee=c=>{if(c==="")n(null),r(null),e(null);else if(c.startsWith("https://")){const m=T(c);Y(m)}},se=c=>{c===""||c.trim()===""?(r(null),i.current=!0):i.current=!1},te=()=>p?s.jsx(Me,{}):S?s.jsx(Ae,{}):s.jsx(Ie,{items:z||[],onSelectionChange:X,onInputChange:ee,defaultFilter:(c,m)=>{if(!m)return!0;if(!(x==null?void 0:x.find(oe=>oe.full_name===c)))return!1;const re=T(m);return T(c).includes(re)}}),ne=()=>t?u?s.jsx(De,{}):O?s.jsx(ve,{}):s.jsx($,{items:J||[],onSelectionChange:Z,onInputChange:se,isDisabled:!1,selectedKey:o==null?void 0:o.name}):s.jsx($,{items:[],onSelectionChange:()=>{},onInputChange:()=>{},isDisabled:!0});return s.jsxs("div",{className:"flex flex-col gap-4",children:[te(),ne(),s.jsxs(I,{testId:"repo-launch-button",variant:"primary",type:"button",isDisabled:!t||C||p||S,onClick:()=>v({selectedRepository:t,selected_branch:o==null?void 0:o.name}),children:[!C&&"Launch",C&&V("HOME$LOADING")]})]})}function $e(){const{t:e}=d(),{data:t}=P(),n=t?`https://github.com/apps/${t.APP_SLUG}/installations/new`:"";return s.jsx("div",{className:"flex flex-col text-sm underline underline-offset-2 text-content-2 gap-4 w-fit",children:s.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:e(E.HOME$ADD_GITHUB_REPOS)})})}function Le({onRepoSelection:e}){const{providers:t}=B(),{data:n}=P(),{t:o}=d(),r=(n==null?void 0:n.APP_MODE)==="saas",i=t.length>0;return s.jsxs("section",{"data-testid":"repo-connector",className:"w-full flex flex-col gap-6",children:[s.jsx("h2",{className:"heading",children:o("HOME$CONNECT_TO_REPOSITORY")}),!i&&s.jsx(Ce,{}),i&&s.jsx(He,{onRepoSelection:e}),r&&i&&s.jsx($e,{})]})}function we({href:e,issueNumber:t}){return s.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer","data-testid":"task-id",children:["#",s.jsx("span",{className:"underline underline-offset-2",children:t})]})}const Ue=e=>({FAILING_CHECKS:e("HOME$FIX_FAILING_CHECKS"),MERGE_CONFLICTS:e("HOME$RESOLVE_MERGE_CONFLICTS"),OPEN_ISSUE:e("HOME$OPEN_ISSUE"),UNRESOLVED_COMMENTS:e("HOME$RESOLVE_UNRESOLVED_COMMENTS")});function ke({task:e}){const{setOptimisticUserMessage:t}=_e(),{data:n}=F(),{mutate:o,isPending:r}=A(),i=D(),{t:a}=d(),p=(u,O)=>n==null?void 0:n.find(N=>N.full_name===u&&N.git_provider===O),S=()=>{const u=p(e.repo,e.git_provider);return t(a("TASK$ADDRESSING_TASK")),o({selectedRepository:u,suggested_task:e})};let l;if(e.git_provider==="gitlab"){const u=e.task_type==="OPEN_ISSUE"?"issues":"merge_requests";l=`https://gitlab.com/${e.repo}/-/${u}/${e.issue_number}`}else if(e.git_provider==="bitbucket"){const u=e.task_type==="OPEN_ISSUE"?"issues":"pull-requests";l=`https://bitbucket.org/${e.repo}/${u}/${e.issue_number}`}else{const u=e.task_type==="OPEN_ISSUE"?"issues":"pull";l=`https://github.com/${e.repo}/${u}/${e.issue_number}`}return s.jsxs("li",{className:"py-3 border-b border-[#717888] flex items-center pr-6",children:[s.jsx(we,{issueNumber:e.issue_number,href:l}),s.jsxs("div",{className:"w-full pl-8",children:[s.jsx("p",{className:"font-semibold",children:Ue(a)[e.task_type]}),s.jsx("p",{children:e.title})]}),s.jsxs("button",{type:"button","data-testid":"task-launch-button",className:M("underline underline-offset-2 disabled:opacity-80",r&&"no-underline font-bold"),disabled:i,onClick:S,children:[!r&&a("HOME$LAUNCH"),r&&a("HOME$LOADING")]})]})}function Pe({children:e}){return s.jsx("div",{className:"py-3 border-b-1 border-[#717888]",children:s.jsx("h3",{className:"text-[16px] leading-6 font-[500]",children:e})})}function Be({title:e,tasks:t}){return s.jsxs("div",{className:"text-content-2",children:[s.jsx(Pe,{children:e}),s.jsx("ul",{className:"text-sm",children:t.map(n=>s.jsx(ke,{task:n},n.issue_number))})]})}class Fe{static async getSuggestedTasks(){const{data:t}=await me.get("/api/user/suggested-tasks");return t}}function Ge(e){const t={};for(const n of e){const o=`${n.repo}`;t[o]||(t[o]={title:o,tasks:[]}),t[o].tasks.push(n)}return Object.values(t)}const Ke=()=>{const{data:e}=Ne();return b({queryKey:["tasks"],queryFn:Fe.getSuggestedTasks,select:Ge,enabled:!!e})},L=["w-1/4","w-1/2","w-3/4"],Ve=()=>L[Math.floor(Math.random()*L.length)],w=(e=3,t=5)=>Math.floor(Math.random()*(t-e+1))+e;function qe(){return s.jsxs("li",{className:"py-3 border-b border-[#717888] flex items-center pr-6",children:[s.jsx("div",{className:"h-5 w-8 skeleton"}),s.jsxs("div",{className:"w-full pl-8",children:[s.jsx("div",{className:"h-5 w-24 skeleton mb-2"}),s.jsx("div",{className:M("h-5 skeleton",Ve())})]}),s.jsx("div",{className:"h-5 w-16 skeleton"})]})}function Ye({items:e=3}){return s.jsxs("div",{"data-testid":"task-group-skeleton",children:[s.jsx("div",{className:"py-3 border-b border-[#717888]",children:s.jsx("div",{className:"h-6 w-40 skeleton"})}),s.jsx("ul",{children:Array.from({length:e}).map((t,n)=>s.jsx(qe,{},n))})]})}function Qe(){return Array.from({length:w(2,3)}).map((e,t)=>s.jsx(Ye,{items:w(3,5)},t))}function We({filterFor:e}){const{t}=d(),{data:n,isLoading:o}=Ke(),r=e?n==null?void 0:n.filter(a=>a.title===e):n,i=r&&r.length>0;return s.jsxs("section",{"data-testid":"task-suggestions",className:M("flex flex-col w-full",!i&&"gap-6"),children:[s.jsx("h2",{className:"heading",children:t(E.TASKS$SUGGESTED_TASKS)}),s.jsxs("div",{className:"flex flex-col gap-6",children:[o&&s.jsx(Qe,{}),!i&&!o&&s.jsx("p",{children:t(E.TASKS$NO_TASKS_AVAILABLE)}),r==null?void 0:r.map((a,p)=>s.jsx(Be,{title:decodeURIComponent(a.title),tasks:a.tasks},p))]})]})}function ze(){const{t:e}=d();return s.jsxs("section",{className:"bg-base-secondary rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4 text-content",children:e("HOME$USE_CASES")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx(y,{title:e("HOME$SOFTWARE_DEVELOPMENT"),description:e("HOME$SOFTWARE_DEVELOPMENT_DESC")}),s.jsx(y,{title:e("HOME$DATA_ANALYSIS"),description:e("HOME$DATA_ANALYSIS_DESC")}),s.jsx(y,{title:e("HOME$AUTOMATION"),description:e("HOME$AUTOMATION_DESC")})]})]})}function Je(){const{t:e}=d();return s.jsxs("section",{className:"bg-base-secondary rounded-xl p-6 mb-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4 text-content",children:e("HOME$ABOUT_US")}),s.jsx("p",{className:"text-basic mb-4",children:e("HOME$ABOUT_US_DESC_1")}),s.jsx("p",{className:"text-basic",children:e("HOME$ABOUT_US_DESC_2")})]})}function Xe(){const{t:e}=d();return s.jsxs("section",{className:"bg-base-secondary rounded-xl p-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4 text-content",children:e("HOME$BUSINESS_VALUE")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(_,{title:e("HOME$INCREASED_PRODUCTIVITY"),description:e("HOME$INCREASED_PRODUCTIVITY_DESC")}),s.jsx(_,{title:e("HOME$REDUCED_TECH_DEBT"),description:e("HOME$REDUCED_TECH_DEBT_DESC")}),s.jsx(_,{title:e("HOME$FASTER_ONBOARDING"),description:e("HOME$FASTER_ONBOARDING_DESC")}),s.jsx(_,{title:e("HOME$COST_EFFICIENCY"),description:e("HOME$COST_EFFICIENCY_DESC")})]})]})}function y({title:e,description:t}){return s.jsxs("div",{className:"bg-base p-4 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2 text-content",children:e}),s.jsx("p",{className:"text-basic",children:t})]})}function _({title:e,description:t}){return s.jsxs("div",{className:"bg-base p-4 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2 text-content",children:e}),s.jsx("p",{className:"text-basic",children:t})]})}function Ze(){const{providers:e}=B(),[t,n]=g.useState(null),o=e.length>0;return s.jsxs("div",{"data-testid":"home-screen",className:"bg-base-secondary h-full flex flex-col rounded-xl px-[42px] pt-[42px] gap-8 overflow-y-auto",children:[s.jsx(Oe,{}),s.jsx("hr",{className:"border-[#717888]"}),s.jsxs("main",{className:"flex flex-col md:flex-row justify-between gap-8 mb-8",children:[s.jsx(Le,{onRepoSelection:r=>n(r)}),s.jsx("hr",{className:"md:hidden border-[#717888]"}),o&&s.jsx(We,{filterFor:t})]}),s.jsxs("div",{className:"mb-12",children:[s.jsx(ze,{}),s.jsx(Je,{}),s.jsx(Xe,{})]})]})}const Cs=le(Ze);export{Cs as default};
