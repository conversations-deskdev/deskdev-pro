import{j as s,w as oe,R as N}from"./chunk-NL6KNZEE-aMulfElY.js";import{o as H,e as ie,u as re,M as ce,H as y}from"./help-link-XyzY7dBe.js";import{D as p,u as de}from"./use-settings-Bsb8Zd3z.js";import{u as pe}from"./use-save-settings-Ept-aF2B.js";import{S as R,a as O}from"./switch-skeleton-CgW30AGB.js";import{I as l}from"./declaration-DTN74MXe.js";import{S as d}from"./settings-input-DywAD7rj.js";import{B as Ee}from"./brand-button-CyoWaFBZ.js";import{a as Se,d as me}from"./custom-toast-handlers-zsVC4dT7.js";import{r as Ie}from"./retrieve-axios-error-message-CoJTAmT2.js";import{S as D}from"./settings-dropdown-input-CmgzkTwP.js";import{u as ue}from"./use-config-DZtddvT8.js";import{I as f}from"./input-skeleton-BW1CxBOk.js";import{S as Ae}from"./subtext-skeleton-BVYhEIAb.js";import{K as h}from"./key-status-icon-UANgyaJ3.js";import{g as _e}from"./map-provider-D8d2rI4b.js";import{u as Te}from"./useTranslation-bTmhRewG.js";import"./useQuery-C6Oy5OYj.js";import"./open-hands-axios-BZ-FJWYr.js";import"./open-hands-B3E073cv.js";import"./chunk-EG3YEEN2-C8jgHZop.js";import"./chunk-OBFX2YGI-PKFa5-VF.js";import"./preload-helper-ckwbz45p.js";import"./index-BkEG4wUf.js";import"./utils-FAyyxFNV.js";import"./module-BG7DSedf.js";import"./optional-tag-jSauglgi.js";import"./mutation-DaRitmBy.js";import"./index-nrxvMbfg.js";import"./i18nInstance-DBIXdvxg.js";const Ne=a=>Object.keys(a).length>0&&(!!a.LLM_BASE_URL||a.AGENT!==p.AGENT||a.CONFIRMATION_MODE||!!a.SECURITY_ANALYZER),ye=(a,E)=>{if(!E)return!1;const c=H(a),{provider:i,model:e}=ie(E);return!(i in c&&c[i].models.includes(e))};function fe(){return s.jsxs("div",{"data-testid":"app-settings-skeleton",className:"px-11 py-9 flex flex-col gap-6",children:[s.jsx(R,{}),s.jsx(f,{}),s.jsx(f,{}),s.jsx(f,{}),s.jsx(Ae,{}),s.jsx(R,{}),s.jsx(R,{}),s.jsx(f,{})]})}function he(){const{t:a}=Te(),{mutate:E,isPending:c}=pe(),{data:i}=re(),{data:e,isLoading:b,isFetching:K}=de(),{data:x}=ue(),[S,L]=N.useState("basic"),[B,g]=N.useState(!1),[z,r]=N.useState({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1}),V=H((i==null?void 0:i.models)||[]);N.useEffect(()=>{const n=i&&e?ye(i.models,e.LLM_MODEL)||Ne({...e}):!1;e&&g(e.CONFIRMATION_MODE),L(n?"advanced":"basic")},[e,i]);const j=()=>{me(a(l.SETTINGS$SAVED)),r({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1})},Y=t=>{const n=Ie(t);Se(n||a(l.ERROR$GENERIC))},Z=t=>{var _,T,m,I;const n=(_=t.get("llm-provider-input"))==null?void 0:_.toString(),o=n?_e(n):void 0,u=(T=t.get("llm-model-input"))==null?void 0:T.toString(),C=(m=t.get("llm-api-key-input"))==null?void 0:m.toString(),M=(I=t.get("search-api-key-input"))==null?void 0:I.toString(),A=o&&u&&`${o}/${u}`;E({LLM_MODEL:A,llm_api_key:C||null,SEARCH_API_KEY:M||"",LLM_BASE_URL:p.LLM_BASE_URL,AGENT:p.AGENT,CONFIRMATION_MODE:p.CONFIRMATION_MODE,SECURITY_ANALYZER:p.SECURITY_ANALYZER,ENABLE_DEFAULT_CONDENSER:p.ENABLE_DEFAULT_CONDENSER},{onSuccess:j,onError:Y})},W=t=>{var m,I,P,G,U,k,$,F;const n=(m=t.get("llm-custom-model-input"))==null?void 0:m.toString(),o=(I=t.get("base-url-input"))==null?void 0:I.toString(),u=(P=t.get("llm-api-key-input"))==null?void 0:P.toString(),C=(G=t.get("search-api-key-input"))==null?void 0:G.toString(),M=(U=t.get("agent-input"))==null?void 0:U.toString(),A=((k=t.get("enable-confirmation-mode-switch"))==null?void 0:k.toString())==="on",_=(($=t.get("enable-memory-condenser-switch"))==null?void 0:$.toString())==="on",T=(F=t.get("security-analyzer-input"))==null?void 0:F.toString();E({LLM_MODEL:n,LLM_BASE_URL:o,llm_api_key:u||null,SEARCH_API_KEY:C||"",AGENT:M,CONFIRMATION_MODE:A,ENABLE_DEFAULT_CONDENSER:_,SECURITY_ANALYZER:A?T:void 0},{onSuccess:j,onError:Y})},X=t=>{S==="basic"?Z(t):W(t)},q=t=>{g(!!(e!=null&&e.CONFIRMATION_MODE)),L(t?"advanced":"basic"),r({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1})},J=t=>{const n=t!==(e==null?void 0:e.LLM_MODEL.replace("openai/",""));r(o=>({...o,model:n}))},w=t=>{const n=t!=="";r(o=>({...o,apiKey:n}))},v=t=>{const n=t!==(e==null?void 0:e.SEARCH_API_KEY);r(o=>({...o,searchApiKey:n}))},Q=t=>{const n=t!==(e==null?void 0:e.LLM_MODEL)&&t!=="";r(o=>({...o,model:n}))},ee=t=>{const n=t!==(e==null?void 0:e.LLM_BASE_URL);r(o=>({...o,baseUrl:n}))},te=t=>{const n=t!==(e==null?void 0:e.AGENT)&&t!=="";r(o=>({...o,agent:n}))},se=t=>{g(t);const n=t!==(e==null?void 0:e.CONFIRMATION_MODE);r(o=>({...o,confirmationMode:n}))},ae=t=>{const n=t!==(e==null?void 0:e.ENABLE_DEFAULT_CONDENSER);r(o=>({...o,enableDefaultCondenser:n}))},ne=t=>{const n=t!==(e==null?void 0:e.SECURITY_ANALYZER);r(o=>({...o,securityAnalyzer:n}))},le=Object.values(z).some(t=>t);return!e||K?s.jsx(fe,{}):s.jsx("div",{"data-testid":"llm-settings-screen",className:"h-full",children:s.jsxs("form",{action:X,className:"flex flex-col h-full justify-between",children:[s.jsxs("div",{className:"p-9 flex flex-col gap-6",children:[s.jsx(O,{testId:"advanced-settings-switch",defaultIsToggled:S==="advanced",onToggle:q,isToggled:S==="advanced",children:a(l.SETTINGS$ADVANCED)}),S==="basic"&&s.jsxs("div",{"data-testid":"llm-settings-form-basic",className:"flex flex-col gap-6",children:[!b&&!K&&s.jsx(ce,{models:V,currentModel:e.LLM_MODEL||"anthropic/claude-sonnet-4-20250514",onChange:J}),s.jsx(d,{testId:"llm-api-key-input",name:"llm-api-key-input",label:a(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:e.LLM_API_KEY_SET?"<hidden>":"",onChange:w,startContent:e.LLM_API_KEY_SET&&s.jsx(h,{isSet:e.LLM_API_KEY_SET})}),s.jsx(y,{testId:"llm-api-key-help-anchor",text:a(l.SETTINGS$DONT_KNOW_API_KEY),linkText:a(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"}),s.jsx(d,{testId:"search-api-key-input",name:"search-api-key-input",label:a(l.SETTINGS$SEARCH_API_KEY),type:"password",className:"w-full max-w-[680px]",defaultValue:e.SEARCH_API_KEY||"",onChange:v,placeholder:a(l.API$TAVILY_KEY_EXAMPLE),startContent:e.SEARCH_API_KEY_SET&&s.jsx(h,{isSet:e.SEARCH_API_KEY_SET})}),s.jsx(y,{testId:"search-api-key-help-anchor",text:a(l.SETTINGS$SEARCH_API_KEY_OPTIONAL),linkText:a(l.SETTINGS$SEARCH_API_KEY_INSTRUCTIONS),href:"https://tavily.com/"})]}),S==="advanced"&&s.jsxs("div",{"data-testid":"llm-settings-form-advanced",className:"flex flex-col gap-6",children:[s.jsx(d,{testId:"llm-custom-model-input",name:"llm-custom-model-input",label:a(l.SETTINGS$CUSTOM_MODEL),defaultValue:e.LLM_MODEL||"anthropic/claude-sonnet-4-20250514",placeholder:"anthropic/claude-sonnet-4-20250514",type:"text",className:"w-full max-w-[680px]",onChange:Q}),s.jsx(d,{testId:"base-url-input",name:"base-url-input",label:a(l.SETTINGS$BASE_URL),defaultValue:e.LLM_BASE_URL,placeholder:"https://api.openai.com",type:"text",className:"w-full max-w-[680px]",onChange:ee}),s.jsx(d,{testId:"llm-api-key-input",name:"llm-api-key-input",label:a(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:e.LLM_API_KEY_SET?"<hidden>":"",onChange:w,startContent:e.LLM_API_KEY_SET&&s.jsx(h,{isSet:e.LLM_API_KEY_SET})}),s.jsx(y,{testId:"llm-api-key-help-anchor-advanced",text:a(l.SETTINGS$DONT_KNOW_API_KEY),linkText:a(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"}),s.jsx(d,{testId:"search-api-key-input",name:"search-api-key-input",label:a(l.SETTINGS$SEARCH_API_KEY),type:"password",className:"w-full max-w-[680px]",defaultValue:e.SEARCH_API_KEY||"",onChange:v,placeholder:a(l.API$TVLY_KEY_EXAMPLE),startContent:e.SEARCH_API_KEY_SET&&s.jsx(h,{isSet:e.SEARCH_API_KEY_SET})}),s.jsx(y,{testId:"search-api-key-help-anchor",text:a(l.SETTINGS$SEARCH_API_KEY_OPTIONAL),linkText:a(l.SETTINGS$SEARCH_API_KEY_INSTRUCTIONS),href:"https://tavily.com/"}),s.jsx(D,{testId:"agent-input",name:"agent-input",label:a(l.SETTINGS$AGENT),items:(i==null?void 0:i.agents.map(t=>({key:t,label:t})))||[],defaultSelectedKey:e.AGENT,isClearable:!1,onInputChange:te,wrapperClassName:"w-full max-w-[680px]"}),(x==null?void 0:x.APP_MODE)==="saas"&&s.jsx(D,{testId:"runtime-settings-input",name:"runtime-settings-input",label:s.jsxs(s.Fragment,{children:[a(l.SETTINGS$RUNTIME_SETTINGS),s.jsx("a",{href:"mailto:contact@all-hands.dev",children:a(l.SETTINGS$GET_IN_TOUCH)})]}),items:[],isDisabled:!0,wrapperClassName:"w-full max-w-[680px]"}),s.jsx(O,{testId:"enable-memory-condenser-switch",name:"enable-memory-condenser-switch",defaultIsToggled:e.ENABLE_DEFAULT_CONDENSER,onToggle:ae,children:a(l.SETTINGS$ENABLE_MEMORY_CONDENSATION)}),s.jsx(O,{testId:"enable-confirmation-mode-switch",name:"enable-confirmation-mode-switch",onToggle:se,defaultIsToggled:e.CONFIRMATION_MODE,isBeta:!0,children:a(l.SETTINGS$CONFIRMATION_MODE)}),B&&s.jsx(D,{testId:"security-analyzer-input",name:"security-analyzer-input",label:a(l.SETTINGS$SECURITY_ANALYZER),items:(i==null?void 0:i.securityAnalyzers.map(t=>({key:t,label:t})))||[],placeholder:a(l.SETTINGS$SECURITY_ANALYZER_PLACEHOLDER),defaultSelectedKey:e.SECURITY_ANALYZER,isClearable:!0,showOptionalTag:!0,onInputChange:ne,wrapperClassName:"w-full max-w-[680px]"})]})]}),s.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:s.jsxs(Ee,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:!le||c,children:[!c&&a("SETTINGS$SAVE_CHANGES"),c&&a("SETTINGS$SAVING")]})})]})})}const et=oe(he);export{et as default};
